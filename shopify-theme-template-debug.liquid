{% comment %}
  TEMPLATE SHOPIFY THEME.LIQUID - VERSION DEBUG
  À copier dans : Thème → Modifier le code → layout → theme.liquid
  
  Cette version inclut des logs de débogage pour identifier les problèmes
{% endcomment %}

<!doctype html>
<html>
<head>
  <title>{% if template.name == 'index' %}LA CHIENNETÉ{% else %}{{ page_title }}{% endif %}</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  {{ content_for_header }}
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #000;
    }
    iframe {
      border: none;
    }
    .debug-info {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.8);
      color: #00ff00;
      padding: 10px;
      font-family: monospace;
      font-size: 12px;
      z-index: 99999999;
      border: 1px solid #00ff00;
      max-width: 400px;
      display: none; /* Masquer en production */
    }
    .debug-info.show {
      display: block;
    }
  </style>
</head>
<body>
  {% comment %}
    Construire l'URL avec les paramètres Shopify
  {% endcomment %}
  
  {% assign app_url = 'https://chiennete-production.up.railway.app' %}
  {% assign template_param = template.name %}
  {% assign handle_param = '' %}
  
  {% if template.name == 'product' %}
    {% assign handle_param = product.handle %}
  {% elsif template.name == 'article' %}
    {% assign handle_param = article.handle %}
  {% endif %}
  
  {% if handle_param != '' %}
    {% assign full_url = app_url | append: '?shopify_template=' | append: template_param | append: '&shopify_handle=' | append: handle_param %}
  {% else %}
    {% assign full_url = app_url | append: '?shopify_template=' | append: template_param %}
  {% endif %}
  
  {% comment %} Info de débogage {% endcomment %}
  <div class="debug-info" id="debug-info">
    <div><strong>Template:</strong> {{ template_param }}</div>
    <div><strong>Handle:</strong> {{ handle_param }}</div>
    <div><strong>URL:</strong> {{ full_url }}</div>
    <div><strong>App URL:</strong> {{ app_url }}</div>
  </div>
  
  <iframe 
    id="app-iframe"
    src="{{ full_url }}"
    style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; border: none; z-index: 9999999; background: #000;"
    allowfullscreen
    onload="console.log('Iframe loaded successfully'); document.getElementById('debug-info').classList.add('show');"
    onerror="console.error('Iframe error'); alert('Erreur de chargement de l\'iframe');"
  ></iframe>
  
  {% comment %} 
    content_for_layout est requis par Shopify mais on le masque avec CSS
  {% endcomment %}
  <div style="display: none;">
    {{ content_for_layout }}
  </div>
  
  <script>
    // Logs de débogage
    console.log('Shopify Theme Template Loaded');
    console.log('App URL:', '{{ app_url }}');
    console.log('Full URL:', '{{ full_url }}');
    console.log('Template:', '{{ template_param }}');
    console.log('Handle:', '{{ handle_param }}');
    
    // Vérifier si l'iframe charge
    const iframe = document.getElementById('app-iframe');
    iframe.addEventListener('load', function() {
      console.log('✅ Iframe chargée avec succès');
      try {
        // Essayer d'accéder au contenu (peut échouer à cause de CORS)
        console.log('Iframe contentWindow:', iframe.contentWindow);
      } catch(e) {
        console.log('⚠️ Impossible d\'accéder au contenu de l\'iframe (normal si CORS)');
      }
    });
    
    iframe.addEventListener('error', function() {
      console.error('❌ Erreur de chargement de l\'iframe');
      alert('Erreur: L\'application React ne peut pas être chargée. Vérifiez l\'URL: {{ full_url }}');
    });
    
    // Afficher les infos de débogage après 2 secondes
    setTimeout(function() {
      document.getElementById('debug-info').classList.add('show');
    }, 2000);
  </script>
</body>
</html>

