{% comment %}
  TEMPLATE SHOPIFY THEME.LIQUID
  À copier dans : Thème → Modifier le code → layout → theme.liquid
  
  Ce template charge votre app React dans un iframe sur toutes les pages Shopify
  et passe les paramètres nécessaires pour router vers les bonnes pages.
{% endcomment %}

<!doctype html>
<html>
<head>
  <title>{% if template.name == 'index' %}LA CHIENNETÉ{% else %}{{ page_title }}{% endif %}</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  {{ content_for_header }}
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    iframe {
      border: none;
    }
  </style>
</head>
<body>
  {% comment %}
    Construire l'URL avec les paramètres Shopify
    - shopify_template: type de page (index, product, article, etc.)
    - shopify_handle: handle du produit/article pour router vers la bonne page
  {% endcomment %}
  
  {% assign app_url = 'https://chiennete-production.up.railway.app' %}
  {% assign template_param = template.name %}
  {% assign handle_param = '' %}
  
  {% if template.name == 'product' %}
    {% assign handle_param = product.handle %}
  {% elsif template.name == 'article' %}
    {% assign handle_param = article.handle %}
  {% endif %}
  
  {% if handle_param != '' %}
    {% assign full_url = app_url | append: '?shopify_template=' | append: template_param | append: '&shopify_handle=' | append: handle_param %}
  {% else %}
    {% assign full_url = app_url | append: '?shopify_template=' | append: template_param %}
  {% endif %}
  
  <iframe 
    id="app-iframe"
    src="{{ full_url }}"
    style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; border: none; z-index: 9999999; background: #000;"
    allowfullscreen
  ></iframe>
  
  {% comment %} 
    content_for_layout est requis par Shopify mais on le masque avec CSS
    car on affiche uniquement l'iframe
  {% endcomment %}
  <div style="display: none !important; visibility: hidden !important;">
    {{ content_for_layout }}
  </div>
  
  <script>
    // Vérifier que l'iframe charge
    const iframe = document.getElementById('app-iframe');
    let loadTimeout;
    
    iframe.addEventListener('load', function() {
      console.log('✅ Iframe chargée:', '{{ full_url }}');
      clearTimeout(loadTimeout);
    });
    
    iframe.addEventListener('error', function() {
      console.error('❌ Erreur de chargement de l\'iframe');
      document.body.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100vh; color: white; font-family: monospace;"><div>Erreur: Impossible de charger l\'application.<br>URL: {{ full_url }}</div></div>';
    });
    
    // Timeout après 10 secondes
    loadTimeout = setTimeout(function() {
      if (!iframe.contentDocument || iframe.contentDocument.readyState !== 'complete') {
        console.warn('⚠️ L\'iframe prend trop de temps à charger');
      }
    }, 10000);
    
    console.log('Shopify Theme - Chargement de:', '{{ full_url }}');
  </script>
</body>
</html>

